> NGINX를 리버스 프록시로 사용하기

# 리버스 프록시 서버란 무엇인가?

내부 어플리케이션과 외부 클라이언트 사이에 자리잡아서 클라이언트의 요청을 적절한 서버로 보내주는 역할을 하는 것입니다. 노드js나 tomcat같은 많은 일반적인 어플리케이션들은 스스로 서버와 같은 역할을 할 수 있긴합니다. 근데 NGINX는 많은 어플리케이션들이 자체적으로 가지지 못한 로드 밸런싱, 보안, 가속화 기능 등 많은 진보된 기능을 갖고 있습니다.

이 가이드에서는 간단한 노드js 앱을 어떻게 NGINX 프록시 서버로 설정(configure)하는지에 대해 보여줄 것입니다.

# NGINX 설치하기

이 과정들은 NGINX Inc의 공식 레퍼지토리에서 NGINX Mainline을 우분투에 설치하는 과정입니다. [NGINX 어드민 가이드](https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#installing-a-prebuilt-package). production 환경을 위한 NGINX 설정에 대한 정보는 [여기](https://www.linode.com/docs/web-servers/nginx/nginx-installation-and-basic-setup/)에서 볼 수 있습니다.

1. 텍스트 에디터에서 `/etc/apt/source.list`를 여시고 `deb http://nginx.org/packages/mainline/ubuntu/ CODENAME nginx` 을 맨 밑에 추가하세요. 이 예제에서 `CODENAME`을 우분투 릴리즈 코드네임으로 바꾸세요. 예를 들면 우분투 18.04라면 Bionic Beaver라는 이름이 있습니다. 그럼 아래 `CODENAME`을 `bionic`으로 바꾸세요.

2. 저장소의 패키지 signing key를 삽입(import)한 뒤에  apt에 추가해주세요.

```bash
sudo wget http://nginx.org/keys/nginx_signing.key
sudo apt-key add nginx_signing.key
```

3. NGINX를 설치해주세요.

```bash
sudo apt update
sudo apt install nginx
```

4. NGINX가 가동 중인 것을 확인하고 재시작 시 자동으로 시작 가능하게 만들어주세요. 

```bash
sudo systemctl start nginx
sudo systemctl enable nginx
```

# 노드 js 설치하기

- 이 부분은 영어 원문과 다르게 가겠습니다. 번역 원문에서는 노드 9.x버전을 설치하기 위해 쉘 파일을 깔고 실행하는데 사실 최신버전으로 해도 상관이 없습니다. 원문이 궁금하신 분들은 [여기](https://www.linode.com/docs/web-servers/nginx/use-nginx-reverse-proxy/)를 클릭하여 확인해보세요.

- 원문의 스크립트 실행은 생략하고 노드 js를 그냥 바로 설치해주세요
```bash
sudo apt install nodejs npm
```

# 노드 app 설정(configure)하기

1. 디렉토리를 만들고 example app을 만들어주세요.

```bash
make nodeapp && cd nodeapp
```

2. 디렉토리 내에서 nodejs 앱을 초기화주세요.

```bash
npm init
```

3. express js를 설치해주세요.

```bash
npm install --save express
```

4. `app.js`파일의 내용을 다음과 같이 바꿔주세요.

```js
const express = require('express');
const app = express();

app.get('/', (req, res) => res.send('Hello World!'));
app.listen(3000, () => console.log('Node.js app listening'));
```

5. 앱을 실행해주세요

```bash
node app.js
```

6. 별개의 터미널에서 앱이 제대로 작동하는지 확인하기 위해 `curl`명령어를 날려봅시다. 
```bash
curl localhost:3000
```

아마 Hello World!라는 화면을 보실 수 있을 겁니다.

